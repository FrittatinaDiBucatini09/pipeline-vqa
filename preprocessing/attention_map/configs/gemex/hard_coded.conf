# ==============================================================================
# CONFIGURATION FILE: Hardcoded Default Parameters
# ==============================================================================
# This file contains all explicit default values as defined in the main
# run_bbox_preprocessing.sh script. Use to restore baseline behavior or as a
# configuration template for experimentation.
# ==============================================================================

# ------------------------------------------------------------------------------
# 1. CORE SETUP & CONTAINER CONFIGURATION
# ------------------------------------------------------------------------------
IMAGE_NAME="bbox_preprocessing:3090"

# ------------------------------------------------------------------------------
# 2. HOST PATH DEFINITIONS
# ------------------------------------------------------------------------------
# Note: $PHYS_DIR is inherited from the calling script
OUTPUT_DIR="$PHYS_DIR/results"
METADATA_DIR="$PHYS_DIR"
HF_CACHE_DIR="$PHYS_DIR/hf_cache"

# ------------------------------------------------------------------------------
# 3. CSV METADATA COLUMN MAPPING
# ------------------------------------------------------------------------------
METADATA_FILENAME="gemex_VQA_mimic_mapped.csv"
PATH_COLUMN="image_path"
BOX_COLUMN="visual_locations"
TEXT_COLUMN="question"
VIS_REGIONS_COL="visual_regions"
FALLBACK_PROMPT="medical abnormality"

# ------------------------------------------------------------------------------
# 4. HARDWARE & PERFORMANCE PARAMETERS
# ------------------------------------------------------------------------------
BATCH_SIZE=16
NUM_WORKERS=4

# ------------------------------------------------------------------------------
# 5. DEBUGGING & EXECUTION LIMITS
# ------------------------------------------------------------------------------
# Use empty string "" to process entire dataset, or numeric value (e.g., "5")
STOP_AFTER="5"

# ------------------------------------------------------------------------------
# 6. INFERENCE MODE SELECTION
# ------------------------------------------------------------------------------
MODE="inference"            # Valid options: 'inference' or 'gold'
OUTPUT_FORMAT="image"       # Output formats: 'image' or 'jsonl'

# ------------------------------------------------------------------------------
# 7. QUESTION-DRIVEN MULTI-BOX CONFIGURATION
# ------------------------------------------------------------------------------
USE_DYNAMIC_PROMPTS="true"  # Use 'question' column as dynamic prompts
USE_VISUAL_REGIONS="false"  # Disable anatomical region guidance
COMPOSITE_REGIONS="false"   # Region aggregation (requires USE_VISUAL_REGIONS=true)
EXPLODE_REGIONS="false"     # Single box per region (requires USE_VISUAL_REGIONS=true)
INCLUDE_CONTEXT_IN_INFERENCE="false"

# ------------------------------------------------------------------------------
# 8. ADAPTIVE PADDING STRATEGY
# ------------------------------------------------------------------------------
PAD_MAX=0.25                # +25% padding for small boxes
PAD_MIN=0.02                # +2% padding for large boxes
ENABLE_SMART_PADDING="true" # Use body mask for anatomical constraint

# ------------------------------------------------------------------------------
# 9. MULTI-BOX DETECTION CONFIGURATION
# ------------------------------------------------------------------------------
ENABLE_MULTI_BOXES="true"   # Detect disconnected activation regions
MIN_BOX_AREA="0.005"        # Noise filter: 0.5% of image area

# ------------------------------------------------------------------------------
# 10. THRESHOLDING & MODEL TUNING
# ------------------------------------------------------------------------------
CAM_THRESHOLD=0.45          # Activation threshold (0.45 recommended for VQA)
CAM_VERSION="gScoreCAM"     # Class activation mapping method

# ------------------------------------------------------------------------------
# 11. ADDITIONAL PROCESSING PARAMETERS
# ------------------------------------------------------------------------------
SKIP_CRF="true"             # true = Fast Mode, false = CRF refinement
ENABLE_BODY_MASK="true"     # Enable Otsu-based body masking
ENABLE_ANATOMICAL_CHECK="true" # Heuristic box content validation
DRAW_LABELS="true"          # Annotate bounding boxes with labels
BOX_COLOR="255,0,255"       # Magenta (RGB format)

# ------------------------------------------------------------------------------
# 12. MODEL ARCHITECTURE SPECIFICATIONS
# ------------------------------------------------------------------------------
MODEL_NAME="hf-hub:microsoft/BiomedCLIP-PubMedBERT_256-vit_base_patch16_224"
CLIP_VERSION="ViT-B/16"
TOPK=300                    # Top-k activations for CAM generation

# ------------------------------------------------------------------------------
# 13. DENSE CRF HYPERPARAMETERS (When SKIP_CRF="false")
# ------------------------------------------------------------------------------
CRF_M=6                     # Number of CRF mean-field iterations
CRF_TAU=0.80                # Unary potential weight
CRF_GAUSSIAN_SXY=15         # Gaussian kernel spatial standard deviation
CRF_GAUSSIAN_COMPAT=2       # Gaussian compatibility weight
CRF_BILATERAL_SXY=15        # Bilateral kernel spatial standard deviation
CRF_BILATERAL_SRGB=5        # Bilateral kernel color standard deviation
CRF_BILATERAL_COMPAT=3      # Bilateral compatibility weight

# ------------------------------------------------------------------------------
# 14. ADVANCED REFINEMENT PARAMETERS
# ------------------------------------------------------------------------------
CRF_CUTOFF="0.4"            # Pre-CRF hard threshold cutoff (range: 0.4 - 0.7)