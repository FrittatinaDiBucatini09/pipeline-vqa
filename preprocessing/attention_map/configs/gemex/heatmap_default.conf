# ==============================================================================
# CONFIGURATION FILE: Heatmap Generation Defaults
# ==============================================================================
# Default configuration for the Attention Map Heatmap Pipeline.
# ==============================================================================

# ------------------------------------------------------------------------------
# 1. CORE SETUP
# ------------------------------------------------------------------------------
IMAGE_NAME="heatmap_gen:3090"

# ------------------------------------------------------------------------------
# 2. HEATMAP SPECIFIC PARAMETERS
# ------------------------------------------------------------------------------
ALPHA=0.5                   # Blending factor (0.0=original, 1.0=heatmap)
COLORMAP="jet"              # Options: jet, turbo, inferno, hot
SAVE_RAW_CAM="false"        # Save raw grayscale CAM alongside overlay?

# ------------------------------------------------------------------------------
# 3. CSV METADATA MAPPING
# ------------------------------------------------------------------------------
METADATA_FILENAME="gemex_VQA_mimic_mapped.csv"
PATH_COLUMN="image_path"
TEXT_COLUMN="question"
VIS_REGIONS_COL="visual_regions"
FALLBACK_PROMPT="medical abnormality"

# ------------------------------------------------------------------------------
# 4. HARDWARE & PERFORMANCE
# ------------------------------------------------------------------------------
BATCH_SIZE=16
NUM_WORKERS=4
STOP_AFTER="5"

# ------------------------------------------------------------------------------
# 5. INFERENCE CONFIGURATION
# ------------------------------------------------------------------------------
USE_DYNAMIC_PROMPTS="true"
USE_VISUAL_REGIONS="false"
COMPOSITE_REGIONS="false"
EXPLODE_REGIONS="false"
INCLUDE_CONTEXT_IN_INFERENCE="false"

# ------------------------------------------------------------------------------
# 6. ARTIFACT REMOVAL & DISPLAY
# ------------------------------------------------------------------------------
ENABLE_BODY_MASK="true"         # Otsu thresholding
DRAW_LABELS="true"              # Annotate prompts on images
CAM_VERSION="gScoreCAM"
CAM_THRESHOLD=0.0               # Not used in heatmap mode (we visualize raw values)

# ------------------------------------------------------------------------------
# 7. CRF REFINEMENT (Optional)
# ------------------------------------------------------------------------------
SKIP_CRF="false"                # Set to "false" to enable CRF
CRF_CUTOFF=0.0                  # Pre-CRF hard threshold
CRF_M=6                         # Iterations
CRF_TAU=0.80
CRF_GAUSSIAN_SXY=15
CRF_GAUSSIAN_COMPAT=2
CRF_BILATERAL_SXY=15
CRF_BILATERAL_SRGB=5
CRF_BILATERAL_COMPAT=3

# ------------------------------------------------------------------------------
# 8. MODEL ARCHITECTURE
# ------------------------------------------------------------------------------
MODEL_NAME="hf-hub:microsoft/BiomedCLIP-PubMedBERT_256-vit_base_patch16_224"
CLIP_VERSION="ViT-B/16"
TOPK=300
